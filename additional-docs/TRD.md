# Niva — Technical Requirements Document (TRD)

**Document Version:** 2.0  
**Date:** February 4, 2026  
**Owner:** Engineering Team  
**Status:** Enhanced with Revolutionary Technical Architecture  
**Depends On:** PRD v2.0  

---

## 1. Purpose & Scope

This document defines the revolutionary technical architecture required to support Niva's breakthrough features: predictive health intelligence, emotional health integration, community wisdom networks, AI-powered health coaching, and intergenerational health mapping. Every architectural decision is driven by the need to deliver unprecedented capabilities while maintaining the core constraints of rural Indian deployment.

---

## 2. Revolutionary Architecture Philosophy

Five principles govern every technical decision in this next-generation system:

**Predictive-First, Reactive-Optional.** The system is designed to predict and prevent health issues before they manifest, with reactive symptom checking as a fallback capability.

**Emotional-Physical Integration.** Mental and physical health are treated as inseparable aspects of a unified health model, with AI systems trained to recognize and respond to both simultaneously.

**Community-Individual Symbiosis.** Individual health insights improve community intelligence, while community patterns enhance individual predictions, creating a self-improving ecosystem.

**Cultural-Scientific Synthesis.** Traditional wisdom and modern medicine are integrated through AI-powered validation and verification systems, creating a new paradigm for culturally-sensitive healthcare.

**Intergenerational Intelligence.** Health patterns are analyzed across three generations to provide unprecedented family health insights and predictive capabilities.

---

## 3. Revolutionary System Architecture

The system is decomposed into **seven interconnected layers** that enable breakthrough capabilities:

### Layer 1: Enhanced On-Device Application (Client)

This layer now includes revolutionary AI capabilities that were previously impossible on mobile devices.

Components include the **Emotional Intelligence Voice Engine** (speech-to-text with emotional state recognition and culturally-aware text-to-speech), the **Predictive Health AI Companion** (a multi-modal AI system that processes text, voice, environmental data, and temporal patterns), the **Intergenerational Knowledge Base** (three-generation health pattern database with genetic predisposition modeling), the **Environmental Health Monitor** (integrates local air quality, weather, and water data for health predictions), and the **Cultural Wisdom Validator** (blockchain-connected system for verifying traditional remedies).

### Layer 2: Predictive Intelligence Layer (NEW)

This revolutionary layer enables health prediction before symptoms appear.

Components include the **Pre-Symptomatic Risk Engine** (analyzes environmental, seasonal, and personal data to predict health risks 2-4 weeks in advance), the **Environmental Health Correlator** (links local environmental conditions to health outcomes), the **Seasonal Disease Forecaster** (predicts disease outbreaks with village-level precision), and the **Personal Risk Calendar Generator** (creates personalized risk calendars for each family member).

### Layer 3: Emotional Health Integration Layer (NEW)

The first mobile health system to seamlessly integrate mental and physical health.

Components include the **Holistic Health Assessor** (evaluates physical symptoms in context of emotional well-being), the **Cultural Mental Health Adapter** (addresses mental health through culturally appropriate frameworks), the **Stress-Physical Correlator** (identifies how emotional stress manifests as physical symptoms), and the **Anonymous Support Network Matcher** (connects users with local support systems).

### Layer 4: Enhanced Sync & Edge Layer

Now includes blockchain capabilities for community wisdom verification.

Components include the **Intelligent Predictive Sync Engine** (syncs predictive models and environmental data), the **Blockchain Wisdom Verifier** (validates traditional remedies through community consensus), the **Enhanced Anonymization Pipeline** (processes multi-dimensional health data while preserving privacy), and the **Environmental Data Cache** (stores local environmental data for offline prediction).

### Layer 5: Revolutionary Backend Services (Cloud)

Expanded to handle predictive analytics, environmental data processing, and community wisdom management.

Services include the **Predictive Health Intelligence Engine** (processes community-wide data to improve individual predictions), the **Environmental Health Analytics Service** (correlates environmental data with health outcomes), the **Community Wisdom Blockchain Network** (manages decentralized traditional knowledge verification), the **AI Health Coach Training Pipeline** (continuously improves personalized coaching models), and the **Intergenerational Pattern Recognition Service** (identifies health patterns across generations).

### Layer 6: Environmental & External Data Layer (NEW)

Integrates real-world environmental data for health predictions.

Components include **Environmental Data APIs** (air quality, weather, water quality, agricultural data), **Satellite Connectivity Services** (for remote area data access), **Government Health Data Integration** (real-time disease surveillance data), and **Community Sensor Networks** (IoT sensors for local environmental monitoring).

### Layer 7: Blockchain & Verification Layer (NEW)

Ensures trust and verification in community wisdom sharing.

Components include **Traditional Knowledge Blockchain** (decentralized verification of remedies), **Community Elder Verification Network** (trusted community members who validate traditional practices), **Remedy Effectiveness Tracking** (anonymous tracking of traditional remedy outcomes), and **Cultural Practice Preservation System** (permanent storage of verified traditional health knowledge).

---

## 4. Revolutionary On-Device AI Strategy

This section details the most technically advanced mobile health AI system ever developed, capable of predictive health intelligence, emotional recognition, and cultural adaptation.

### 4.1 Multi-Modal AI Architecture

The on-device AI system combines **five specialized AI models** working in concert:

**Primary Health Companion Model**: A 2-3B parameter language model (quantized to INT4, ~90MB) fine-tuned for health dialogue with emotional intelligence capabilities.

**Predictive Risk Assessment Model**: A specialized time-series model (~15MB) that analyzes personal history, family patterns, environmental data, and seasonal trends to predict health risks.

**Emotional Intelligence Model**: A lightweight neural network (~8MB) trained to recognize emotional states from voice patterns, text sentiment, and interaction behaviors.

**Cultural Adaptation Model**: A cultural context model (~12MB) that adapts responses based on regional practices, beliefs, and communication styles.

**Environmental Health Correlator**: A specialized model (~10MB) that processes environmental data (air quality, weather, water) to predict health impacts.

### 4.2 Revolutionary Capabilities Matrix

| Capability | On-Device | Cloud | Reasoning |
|------------|-----------|-------|-----------|
| Basic health conversation | ✓ | - | Core offline requirement |
| Emotional state recognition | ✓ | - | Privacy-critical, real-time needed |
| Predictive risk assessment | ✓ | ✓ | Basic predictions offline, complex modeling in cloud |
| Cultural adaptation | ✓ | - | Must work offline, culturally sensitive |
| Environmental health correlation | ✓ | ✓ | Local data offline, broader patterns in cloud |
| Intergenerational pattern analysis | ✓ | ✓ | Family data local, population patterns in cloud |
| Traditional remedy validation | ✓ | ✓ | Basic validation offline, community verification in cloud |
| Community wisdom verification | - | ✓ | Requires blockchain network |
| Advanced genetic predisposition | - | ✓ | Requires large population datasets |
| Cross-community learning | - | ✓ | Requires aggregated community data |

### 4.3 Predictive Intelligence Implementation

The **Pre-Symptomatic Risk Engine** combines multiple data streams:

**Personal Health Timeline**: Analyzes individual health patterns, seasonal vulnerabilities, and family history to identify risk periods.

**Environmental Data Integration**: Processes real-time air quality, weather patterns, water quality, and agricultural data to predict environmental health risks.

**Community Pattern Recognition**: Uses anonymized community data to identify emerging health trends and outbreak risks.

**Intergenerational Analysis**: Analyzes three-generation health patterns to predict genetic predispositions and optimal intervention timing.

The system generates **Personal Risk Calendars** showing each family member's highest-risk periods throughout the year, with specific recommendations for preventive measures.

### 4.4 Emotional Intelligence Integration

The **Emotional Health AI** processes multiple signals:

**Voice Pattern Analysis**: Detects stress, anxiety, depression, and emotional distress from voice characteristics (pitch, pace, tone variations).

**Text Sentiment Analysis**: Analyzes written inputs for emotional indicators and mental health concerns.

**Behavioral Pattern Recognition**: Identifies changes in app usage patterns that may indicate emotional distress.

**Cultural Emotional Mapping**: Adapts emotional recognition to cultural expressions of mental health concerns.

The system provides **Holistic Health Assessment** that considers both physical symptoms and emotional well-being, offering culturally appropriate mental health support without stigmatization.

### 4.5 Cultural Wisdom Integration

The **Community Wisdom Network** uses blockchain technology to:

**Verify Traditional Remedies**: Community elders and health workers can verify the effectiveness and safety of traditional practices.

**Track Remedy Effectiveness**: Anonymously tracks which traditional remedies work for which conditions across the community.

**Preserve Cultural Knowledge**: Creates a permanent, decentralized record of traditional health wisdom.

**Integrate with Modern Medicine**: Provides evidence-based recommendations for combining traditional and modern treatments.

---

## 5. Revolutionary Data Architecture

### 5.1 Enhanced Local Data Store (On-Device)

The local data store now supports multi-generational health tracking, predictive modeling, and emotional health integration.

**Database: `niva_revolutionary.db`**

**Core Entities:**

**households** — Enhanced with intergenerational mapping. Contains household ID, primary caregiver, geographic region, environmental risk factors, cultural preferences, and three-generation family tree structure.

**profiles** — Expanded for comprehensive health tracking. Contains profile ID, household reference, member details, genetic predisposition markers, emotional health baseline, cultural health practices, and intergenerational health patterns.

**health_events** — The foundation of predictive intelligence. Each event includes event ID, profile reference, timestamp, event type, raw input, AI response, severity classification, emotional state indicators, environmental conditions at time of event, and predictive risk factors identified.

**predictive_models** — Stores personalized prediction models for each family member. Contains model ID, profile reference, risk prediction algorithms, seasonal vulnerability patterns, environmental sensitivity factors, and model accuracy metrics.

**environmental_data** — Local environmental monitoring data. Contains timestamp, location, air quality index, weather conditions, water quality indicators, agricultural health data, and health risk correlations.

**cultural_wisdom** — Community-verified traditional knowledge. Contains remedy ID, cultural practice description, community verification status, effectiveness tracking data, safety indicators, and integration recommendations with modern medicine.

**emotional_health_timeline** — Tracks emotional well-being over time. Contains timeline ID, profile reference, emotional state indicators, stress level assessments, mental health risk factors, and correlation with physical symptoms.

**community_challenges** — Social health engagement tracking. Contains challenge ID, household participation, progress tracking, community ranking, and health outcome improvements.

### 5.2 Revolutionary Cloud Data Architecture

The cloud now processes predictive analytics, environmental correlations, and community wisdom verification.

**Storage Technologies:**
- **Time-Series Database (InfluxDB)**: For environmental data and health predictions
- **Graph Database (Neo4j)**: For intergenerational health pattern analysis
- **Blockchain Network (Hyperledger Fabric)**: For community wisdom verification
- **Vector Database (Pinecone)**: For AI model embeddings and similarity search
- **Traditional PostgreSQL**: For user consent, referrals, and system metadata

**Revolutionary Data Flows:**

**Predictive Intelligence Flow**: Environmental data + personal health patterns + community trends → AI prediction models → personalized risk calendars → preventive recommendations

**Community Wisdom Flow**: Traditional remedy reports → community verification → blockchain validation → effectiveness tracking → integration recommendations

**Emotional Health Flow**: Voice patterns + behavioral indicators + cultural context → emotional state assessment → holistic health evaluation → culturally appropriate support

### 5.3 Advanced Anonymization & Privacy Architecture

The system now handles multi-dimensional health data while maintaining privacy.

**Enhanced K-Anonymity Pipeline**: Processes health events, environmental correlations, emotional indicators, and cultural practices with k=15 (increased from k=10) for enhanced privacy.

**Differential Privacy Integration**: Adds mathematical noise to predictive models and community patterns to prevent individual identification while preserving population-level insights.

**Blockchain Privacy**: Community wisdom verification uses zero-knowledge proofs to validate traditional remedies without revealing individual usage patterns.

**Emotional Health Privacy**: Mental health indicators are processed with additional privacy layers, including local-only processing for sensitive emotional data.

---

## 6. API Design

### 6.1 Internal APIs (On-Device)

These are not network APIs. They are the internal module interfaces within the Android application, defined here to establish contracts between components.

**Health Companion API** — The interface between the UI layer and the on-device AI model.

```
POST /local/health/converse
  Input: { profile_id, user_message, conversation_history[], literacy_context_score }
  Output: { response_text, severity_classification, suggested_actions[], updated_lcs }

GET /local/health/timeline/{profile_id}
  Input: { start_date, end_date }
  Output: { events[], patterns[], risk_flags[] }

GET /local/health/family_risks/{household_id}
  Output: { hereditary_flags[], member_correlations[] }
```

**Knowledge Base API** — The interface for Cultural Bridge and regional health lookups.

```
GET /local/knowledge/remedy/{remedy_name}
  Output: { evidence_summary, safety_rating, escalation_conditions[], regional_variants[] }

GET /local/knowledge/seasonal/{region_code}
  Output: { active_advisories[], common_risks[], preventive_measures[] }
```

### 6.2 External APIs (Cloud)

**Sync API**

```
POST /api/v1/sync/upload
  Auth: Device token (not user identity)
  Input: { device_id, cluster_id, aggregated_signals[] }
  Output: { status, pending_updates[] }

GET /api/v1/sync/updates/{device_id}
  Output: { knowledge_base_updates[], model_updates[], government_bulletins[] }
```

**Community Intelligence API**

```
GET /api/v1/community/heatmap/{region_code}
  Auth: ASHA worker token
  Output: { clusters[], alert_flags[], trend_data }

POST /api/v1/community/alert
  Input: { cluster_id, alert_type, severity, details }
  Output: { alert_id, routing_info }
```

**Clinic Integration API** (opt-in only)

```
POST /api/v1/clinic/referral
  Auth: User consent token
  Input: { profile_summary, symptom_summary, preferred_clinic_ids[] }
  Output: { referral_id, clinic_confirmation, appointment_details }
```

### 6.3 API Design Principles

All external APIs are designed around these constraints: authentication is device-based, not user-identity-based, to prevent the backend from being able to correlate health data with a real person. All responses are cacheable and include a TTL, so the app can function on stale data when offline. Rate limiting is generous but present — the system is designed for millions of devices, not millions of requests per device. Error responses include a graceful degradation code that tells the client which features can still function offline.

---

## 7. Offline Architecture — Deep Dive

Offline capability is not an afterthought. It is the **primary architecture constraint**. This section details how it is achieved.

### 7.1 Conflict Resolution

When a device reconnects after an extended offline period, conflicts may exist between local and cloud state. The resolution strategy is:

For user-generated data (health events, profiles), the local version always wins. The user's experience is the source of truth. Cloud updates to knowledge base and model weights are applied as patches on top of local state, never replacing user data. If a knowledge base update contradicts something the user was told while offline, the system flags this as a "new information" notification rather than silently correcting itself. This maintains trust.

### 7.2 Storage Budgeting

On a device with limited storage (typically 16–32 GB shared across all apps), Niva targets a total footprint of under 250MB. This breaks down as follows: the base application and UI assets consume roughly 30MB, the on-device AI model (quantized) takes up approximately 80MB, language adapters (up to 3 active at a time) use about 15MB, the local knowledge base occupies around 60MB, and user data and conversation history (expected to grow over time) starts small and is managed with a rolling archive policy that compresses data older than 90 days.

### 7.3 Model Inference on Low-End Devices

Running a language model on a device with a Snapdragon 425 and 2GB RAM requires careful optimization. The approach combines INT4 quantization (reducing model size and memory footprint by 4x compared to FP16), ONNX Runtime for Android (optimized inference engine), speculative decoding (using a tiny draft model to speed up generation), and batched pre-computation of common response templates (the system pre-generates responses to the 200 most common symptom queries and serves them from cache when appropriate, falling back to live inference for novel queries).

---

## 8. Security Architecture

### 8.1 Data Encryption

All health data on the device is encrypted using AES-256 with a key derived from the device's hardware-backed keystore. The encryption key is never exported from the device. All data in transit uses TLS 1.3. Cloud-stored data (aggregated signals only) is encrypted at rest using AES-256 with key rotation every 90 days.

### 8.2 Authentication & Authorization

The app does not require user accounts in the traditional sense. A household is identified by a locally-generated UUID. When syncing with the cloud, the device authenticates using a device token (a cryptographic credential stored in the hardware keystore) that is not linked to any personally identifiable information. ASHA worker accounts are the only user-identity-linked authentication in the system, and these are scoped to the Co-Pilot mode only. ASHA worker data access is limited to aggregated community data — they cannot view individual household health records.

### 8.3 Threat Model

The primary threats considered during design are: a compromised device (mitigated by hardware-backed encryption), a compromised backend (mitigated by the architecture that prevents individual data from reaching the backend), a social engineering attack where someone impersonates a health worker (mitigated by the ASHA worker authentication flow and the fact that Co-Pilot mode shows only aggregated data), and a man-in-the-middle attack on sync (mitigated by TLS 1.3 with certificate pinning).

---

## 9. Infrastructure & Deployment

### 9.1 Cloud Infrastructure

The backend is deployed on a cloud provider with a presence in India (for data residency compliance with DPDP Act). The architecture is microservices-based, with each service independently scalable. The Community Intelligence Engine is the most compute-intensive service and is designed to scale horizontally during outbreak detection events.

### 9.2 App Distribution

The app is distributed via Google Play Store and, critically, also via **sideloading packages** and WhatsApp-shared APKs. In many rural areas, Play Store access is inconsistent. The app is designed to be installable via a direct APK download link shared by ASHA workers. This is an intentional distribution strategy, not a workaround.

### 9.3 Update Strategy

App updates are pushed via Play Store when available. For devices that cannot access Play Store, updates are delivered via the Sync API — the app checks for a new version on each sync and downloads it in the background. Critical security patches can be force-pushed via this mechanism.

---

## 10. Technology Stack Summary

| Component | Technology | Rationale |
|-----------|-----------|-----------|
| Mobile App | Kotlin (Android) | Native performance, best-in-class Android support |
| On-Device AI | ONNX Runtime + Quantized LLM (INT4) | Cross-platform inference, minimal memory footprint |
| Local Database | SQLite | Zero-config, tiny footprint, battle-tested on Android |
| Voice Engine | On-device TTS/STT (Mozilla TTS / Vosk) | No network dependency for voice |
| Cloud Backend | Go (microservices) | High concurrency, low memory per service, fast cold starts |
| Community Intelligence | Python (data pipeline) + PostgreSQL + TimescaleDB | Time-series queries for outbreak detection |
| Cloud Infrastructure | AWS (Mumbai region) | Data residency, low latency for Indian users |
| Sync Protocol | MQTT (lightweight pub/sub) | Designed for IoT/low-bandwidth scenarios, works on 2G |
| Push Notifications | Firebase Cloud Messaging (FCM) | Native Android integration, works on low-end devices |
| CI/CD | GitHub Actions + Fastlane | Automated build, test, and Play Store deployment |

---

## 11. Performance & Scalability Targets

| Metric | Target | Notes |
|--------|--------|-------|
| On-device inference latency | < 2 seconds per response | After speculative decoding optimization |
| App cold start time | < 3 seconds | On 2GB RAM device |
| Sync upload time (7 days of data) | < 30 seconds | Over 2G connection |
| Cloud API p95 latency | < 200ms | Mumbai region |
| Concurrent ASHA worker sessions | 50,000 | During national health campaign peaks |
| Total registered households (year 1) | 500,000 | Across 5 pilot states |
| Outbreak detection latency | < 4 hours from signal threshold breach | End-to-end, including sync delay |

---

## 12. Monitoring & Observability

On-device telemetry is limited to crash reports and performance metrics — no health data is included in telemetry. Cloud services are monitored via standard observability stack (distributed tracing, structured logging, alerting). The Community Intelligence Engine has a dedicated monitoring dashboard that tracks aggregation pipeline health, outbreak alert accuracy (compared to ground truth from PHCs), and sync success rates by region.

---

*This document defines the technical baseline. All implementation decisions should be validated against the constraints defined in Section 2 (Architecture Philosophy) and the deployment context assumptions in PRD Section 9.*
